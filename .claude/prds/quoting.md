# PRD: Intelligent Quoting System for Solo Workbench

## 📋 PRD概览

**功能名称**: quoting - 智能报价系统
**创建时间**: 2025-09-15
**目标用户**: 个人开发者/自由职业者
**使用场景**: 个人接单工作台的快速报价功能

## 🎯 产品目标

### 一句话描述
将现有Solo Workbench从复杂项目管理工具简化为专注的PRD→报价工具，通过粘贴PRD文本自动识别技术功能点并生成三档报价。

### 核心价值主张
- **效率提升**: 从手动分析PRD到自动识别技术点，节省80%分析时间
- **标准化报价**: 基于技术词典的统一报价标准，避免个人经验偏差
- **可追溯性**: 完整的PRD→功能点→报价链路，支持客户沟通和项目复盘
- **极简操作**: 单页完成从PRD粘贴到报价导出的完整流程

## 🚀 功能需求

### 1. PRD输入与解析
**用户故事**: 作为自由职业者，我希望能够粘贴客户提供的PRD文本，系统自动识别其中的技术功能点。

**功能描述**:
- 支持txt/md格式文本粘贴
- 支持剪贴板快速导入
- 自动文本预处理（格式化、分段、去除噪音）
- 实时字数统计和文本质量评估

**验收标准**:
- ✅ 支持常见格式的PRD文本粘贴
- ✅ 自动识别章节结构和段落层次
- ✅ 提供文本预处理进度反馈
- ✅ 支持200k字符级别PRD；超过阈值采用分段解析与进度提示

### 2. 智能识别系统
**用户故事**: 作为开发者，我希望系统能够准确识别PRD中的技术功能点，包括复杂度和工时估算。

**功能描述**:
- **规则模式（默认）**: 基于技术词典的关键词匹配
- **大模型模式（可选）**: 使用LLM进行深度语义分析
- 复杂度自动评估（S/M/L三级）
- 工时估算基于用户可配置的基准数据（pricing_baselines / app_settings）。系统仅提供默认参考值，最终以用户人工校准为准。
- 置信度评估和证据片段展示

**技术词典（20+标签）**:
```
核心业务模块:
- auth_basic: 认证基础 (16h, M)
- oauth_sns: 第三方登录 (12h, M)
- rbac_workflow: 权限工作流 (40h, L)
- payment: 支付系统 (36h, L)
- files_object: 文件对象管理 (20h, M)
- realtime: 实时通信 (24h, M)
- search: 搜索功能 (24h, M)
- report_dashboard: 报表仪表盘 (28h, M)
- notification: 消息通知 (12h, S)
- geo_map: 地图定位 (20h, M)
- i18n: 多语言 (10h, S)
- multi_tenant: 多租户 (36h, L)
- ai_basic: AI基础 (28h, M)
- security_compliance: 安全合规 (20h, M)
- admin_console: 管理后台 (16h, M)

集成与扩展:
- integration_x: 第三方集成 (16h/个, M)
- observability_logging: 日志审计 (16h, M)
- devops_release: CI/CD部署 (20h, M)
- nfr_perf: 性能优化 (24h, M)
- nfr_reliability: 可靠性保障 (24h, M)
```

**验收标准**:
- ✅ 在用户提供的历史PRD测试集上，以条目级指标评估；经词典迭代后目标75-85%起步，持续提升
- ✅ 支持人工调整识别结果（复杂度、工时）
- ✅ 提供识别置信度和证据片段展示
- ✅ 支持技术词典的自定义维护

### 3. 报价计算引擎
**用户故事**: 作为服务提供者，我希望系统能够基于识别的功能点自动生成三档报价，支持参数化配置。

**功能描述**:
- 复杂度系数统一配置：S=1.0, M=1.5, L=2.2
- 三档价格计算：Basic(0.8x) / Standard(1.0x) / Premium(1.25x)
- 可配置参数：基础价、时薪、复杂度系数、税费预留比例
- 打包项支持：运维部署、测试验收、项目管理沟通
- 实时价格预览和明细展示

**计算公式**:
```
// 定义
subtotal_core = Σ(feature 与 package 明细行金额)
surcharge = subtotal_core × tax_percent
contingency = subtotal_core × contingency_percent

// 总价
total = base_price + subtotal_core + surcharge + contingency

// 三档
Basic   = 0.8 × total
Standard= 1.0 × total
Premium = 1.25 × total
```

**说明**: 税费/预留以feature+package小计为基数；base_price不参与百分比基数，避免"税上加税"。

**验收标准**:
- ✅ 价格计算结果准确无误
- ✅ 支持实时参数调整和价格更新
- ✅ 提供详细的价格明细和计算说明
- ✅ 支持打包项的灵活配置

### 4. 数据管理
**用户故事**: 作为长期用户，我希望能够保存历史PRD和报价记录，支持数据追溯和分析。

**功能描述**:
- PRD历史记录保存和检索
- 识别结果和报价数据的版本管理
- 技术词典和基准数据的可视化维护
- 数据导入导出功能

**验收标准**:
- ✅ 支持PRD文本和识别结果的完整保存
- ✅ 提供历史记录的快速检索和复用
- ✅ 支持技术词典的增删改查操作
- ✅ 提供数据备份和恢复功能

### 5. 界面设计
**用户故事**: 作为使用者，我希望有一个简洁直观的界面，能够在一屏内完成从PRD粘贴到报价导出的完整操作。

**界面布局**:
```
┌─────────────────────────────────────────────────────────────┐
│ 顶部：模式切换（简洁模式/完整模式）｜设置｜历史记录              │
├─────────────────────────────────────────────────────────────┤
│ 左列：PRD粘贴区                │ 右列-上：识别结果表格          │
│ - 支持txt/md格式              │ - 功能条目、复杂度、工时       │
│ - 字数统计                    │ - 置信度、证据片段            │
│ - 「识别关键点」按钮          │ - 人工勾选/调整               │
│                               │                               │
│                               │ 右列-中：报价参数             │
│                               │ - 基础价、时薪、复杂度系数     │
│                               │ - 税费预留比例                │
│                               │ - 打包项配置                  │
│                               │                               │
│                               │ 右列-下：报价预览             │
│                               │ - 三档价格卡片                │
│                               │ - 总价和明细                  │
│                               │ - 导出/保存按钮               │
├─────────────────────────────────────────────────────────────┤
│ 底部：历史记录（最近N次PRD），点击可复用参数与条目            │
└─────────────────────────────────────────────────────────────┘
```

**验收标准**:
- ✅ 界面布局清晰，操作流程直观
- ✅ 支持响应式设计，适配不同屏幕尺寸
- ✅ 提供实时的操作反馈和状态提示
- ✅ 支持键盘快捷键操作

## 🛠️ 技术架构

### 现有架构复用
- **前端**: React 18.2.0 + Tailwind CSS（内嵌于index.html）
- **后端**: Electron 30.0.0 + SQLite 3（桌面）/ IndexedDB（Web回退）
- **通信**: IPC进程间通信

### 数据模型设计
**新增表结构**:
```sql
-- PRD历史记录
prds: id, title, raw_text, created_at, parse_method, extracted_json, confidence

-- 技术关键词词典
keyword_dict: id, tag, display_name, patterns_json TEXT, default_hours, default_complexity, weight
**说明**: patterns以JSON格式存储字符串数组，或采用keyword_patterns(tag, pattern)子表以便索引与维护。

-- 报价基准配置
pricing_baselines: id, tag, base_hours, multiplier_S/M/L, default_rate, notes

-- 全局设置
app_settings: id, hourly_rate_default, base_price_default, complexity_factors, tax_percent_default, contingency_percent_default
```

**现有表结构扩展**:
```sql
-- quotes表扩展
quotes: 新增可选字段（subtotal_before_surcharge: feature+package小计，不含base_price/surcharge/contingency, notes）

-- quote_items表扩展
quote_items: 新增type（feature/package/surcharge/contingency）、meta（JSON存储公式）
```

### 核心算法
1. **文本预处理算法**: 格式化、分段、关键词提取
2. **词典匹配算法**: 多模式匹配、权重计算、冲突解决
3. **复杂度评估算法**: 基于技术特征的自动评级
4. **价格计算算法**: 多层次价格计算和打包项处理

## 📊 实施计划

### P0（核心功能 - 2周）
1. **统一复杂度系数配置**
   - 迁移到pricing_baselines统一管理
   - 前后端统一读取配置源

2. **简洁模式界面**
   - 隐藏Leads/Projects/Tasks/Timesheets功能
   - 新增PRD粘贴区和识别按钮

3. **规则识别引擎**
   - 实现20+技术标签的词典匹配
   - 支持复杂度和工时估算

4. **虚拟线索处理**
   - 实现client_name占位格式：PRD/<yyyy-MM-dd HH:mm>/<slug>
   - 确保数据库约束兼容

5. **报价计算功能**
   - 实现三档价格计算
   - 支持打包项和税费处理

6. **Markdown导出**
   - 实现详细版和简版两种模板
   - 支持报价单的完整导出

### P1（稳定性增强 - 1周）
1. **历史记录管理**
   - PRD文本和识别结果的完整保存
   - 历史记录检索和复用功能

2. **证据查看功能**
   - 识别结果表格支持证据片段查看
   - 置信度评估和不确定性提示

3. **词典维护界面**
   - 技术词典的可视化维护（P0关键能力）
   - 支持词典的导入导出和表格编辑

4. **打包项管理**
   - 实现打包项的灵活配置
   - 支持税费和预留的百分比计算

### P2（可选增强 - 按需）
1. **大模型模式**
   - 集成LLM进行深度语义分析
   - 支持多种模型提供商（OpenAI/Anthropic等）

2. **第三方集成识别**
   - 自动识别PRD中的第三方服务
   - 按集成数量计算工时

3. **高级导出功能**
   - Excel/CSV格式导出
   - PDF格式导出和模板定制

## 🎯 成功指标

### 量化指标
- **效率提升**: PRD分析时间从30分钟缩短到5分钟以内
- **识别准确率**: 在用户提供的历史PRD测试集上，以条目级指标评估；经词典迭代后目标75-85%起步，持续提升
- **用户满意度**: 个人满意度评分，操作流程是否减少手工时间
- **数据完整性**: 历史记录保存率达到100%

### 质量指标
- **系统稳定性**: 功能上线后3个月内无重大bug
- **性能表现**: PRD识别响应时间，大文本(>50k)采用进度分段+结果渐显，以用户感知为先
- **数据安全**: 本地数据加密，支持隐私保护
- **兼容性**: 支持Windows/macOS/Linux三大平台

## 📝 使用场景示例

### 场景1：网站开发项目报价
1. 客户提供网站开发PRD文档
2. 用户粘贴PRD文本到系统
3. 系统自动识别：用户认证、支付系统、后台管理、文件上传等功能点
4. 人工调整复杂度和工时
5. 系统生成三档报价：基础版¥15,000、标准版¥18,750、高级版¥23,438
6. 导出报价单并发送给客户

### 场景2：移动应用开发报价
1. 客户提供移动应用PRD
2. 系统识别：用户认证、实时通信、推送通知、地图定位等功能点
3. 识别到第三方集成：微信登录、支付宝支付、高德地图
4. 系统计算总价并生成三档报价
5. 保存到历史记录供后续参考

## ⚠️ 风险与对策

### 技术风险
- **识别准确率风险**: 通过人工校准和技术词典优化降低风险
- **性能风险**: 通过算法优化和本地缓存保证响应速度
- **兼容性风险**: 通过多平台测试确保兼容性

### 业务风险
- **用户接受度风险**: 通过界面优化和操作引导提升用户体验
- **数据安全风险**: 通过本地存储和加密保护用户隐私
- **维护成本风险**: 通过模块化设计和自动化测试降低维护成本

## 📋 附录

### 技术词典详细配置
详见技术词典配置文档，包含每个标签的关键词模式、默认工时和复杂度设置。

### 报价模板示例
详见报价模板文档，包含详细版和简版两种格式的导出模板。

### 用户操作手册
详见用户手册文档，包含完整的操作流程和使用说明。

---

**PRD状态**: 草稿
**下一步**: 等待确认后进入epic规划阶段
**预计工期**: P0阶段2周，P1阶段1周