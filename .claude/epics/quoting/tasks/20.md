# [P0.1] 统一复杂度系数配置

id: 20
title: 统一复杂度系数到单一配置源并全局生效
priority: P0
estimate: 3番茄 (4小时)
status: completed
depends_on: []
parallel_with: [22, 24, 25]
module: pricing
ext_id:

## 目的/产出
实现复杂度系数（S=1.0, M=1.5, L=2.2）的统一配置管理，前后端一致读取，消除硬编码不一致问题。

## 实施步骤

1. 创建app_settings表结构，支持复杂度系数配置
   - SQLite: CREATE TABLE app_settings (id INTEGER PRIMARY KEY, key TEXT UNIQUE, value TEXT)
   - IndexedDB: 同步创建objectStore

2. 实现配置读取API（统一接口）
   - getComplexityFactors() -> {S: 1.0, M: 1.5, L: 2.2}
   - 支持SQLite/IndexedDB双后端

3. 前端配置组件开发
   - 简单的配置表单界面
   - 实时预览系数变化对价格的影响

4. 迁移现有硬编码复杂度系数
   - 搜索main.js中所有硬编码系数
   - 替换为配置读取API调用

5. 配置验证与测试
   - 验证前后端系数一致性
   - 测试配置修改后的价格计算正确性

## 验收标准

- ✅ app_settings表结构创建成功，可读写配置
- ✅ 复杂度系数API在Electron和Web模式下都正常工作
- ✅ 前端配置界面可以修改系数并实时预览
- ✅ 所有硬编码系数已被替换，无遗漏
- ✅ 价格计算结果与预期一致（Basic/Standard/Premium比例正确）
- ✅ 配置修改后重启应用仍生效

## 约束/边界

**仅修改以下文件/模块**：
- main.js (数据库操作和API)
- index.html (配置UI组件)
- preload.js (API桥接)

**明确不修改**：
- 现有quotes/quote_items表核心结构，仅扩展可选字段
- 复杂度系数的数值（保持1.0/1.5/2.2）
- 其他业务逻辑

## 依赖/并行

- **依赖**: 无，可独立执行
- **可并行**: 22(虚拟线索), 24(规则引擎), 25(词典维护)

## 风险与回退

**可能风险**：
- 现有代码中硬编码系数遗漏
- 配置API在Web模式下兼容性问题

**回退方式**：
- 保留原有硬编码系数作为fallback
- 如API失败，回退到默认系数值
- 数据库操作失败时使用内存配置
