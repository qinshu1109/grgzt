# [P0.5] 词典与基准数据维护界面

id: 25
title: 词典与基准数据的可视化维护（编辑/导入导出/一键重识别）
priority: P0
estimate: 3番茄 (4小时)
status: completed
depends_on: []
parallel_with: [20, 22, 24]
module: admin
ext_id:

## 目的/产出
实现技术词典和报价基准数据的可视化维护界面，支持编辑、导入导出和一键重识别功能。

## 实施步骤

1. 词典维护界面开发
   - 词典列表表格显示（tag、display_name、patterns、hours、complexity）
   - 行内编辑功能：修改patterns、hours、complexity
   - 新增/删除词典条目功能
   - 实时保存和验证

2. 基准数据配置界面
   - pricing_baselines表的可视化编辑
   - 复杂度系数配置（S/M/L数值）
   - 默认时薪和基础价设置
   - 税费预留比例配置

3. 导入导出功能
   - JSON格式的词典数据导入/导出
   - CSV格式的批量导入支持
   - 数据验证和错误提示
   - 导入预览和确认

4. 一键重识别功能
   - 基于最新词典重新识别PRD
   - 对比显示识别结果变化
   - 支持部分或全部重新识别
   - 保存新的识别结果

## 验收标准

- ✅ 词典维护界面可以正常编辑所有字段
- ✅ 基准数据配置界面响应式布局
- ✅ JSON导入导出功能完整，数据格式正确
- ✅ 一键重识别功能工作正常
- ✅ 数据验证有效，防止错误数据保存
- ✅ 界面简洁，个人用户易操作

## 约束/边界

**仅修改以下文件/模块**：
- index.html (新增维护界面组件)
- 相关的CSS样式和JavaScript逻辑

**明确不修改**：
- 现有业务逻辑和识别算法
- 数据库表结构（只读写数据）
- 其他UI组件和功能

## 依赖/并行

- **依赖**: 无，可独立执行
- **可并行**: 20(复杂度系数), 22(虚拟线索), 24(规则引擎)

## 风险与回退

**可能风险**：
- 界面过于复杂影响用户体验
- 数据验证不充分导致错误
- 大量数据的导入性能问题

**回退方式**：
- 简化界面，保留核心功能
- 增强数据验证和错误提示
- 大数据导入时分批处理，显示进度

## 🎉 实现总结

### ✅ 已完成功能

**1. 数据库层实现**
- 创建了 `keyword_dict` 表：存储技术词典条目（tag、display_name、patterns、hours、complexity、weight）
- 创建了 `pricing_baselines` 表：存储报价基准数据（tag、base_hours、multiplier_S/M/L、default_rate）

**2. 后端API接口**
- 词典管理：`getKeywordDict`, `addKeywordDict`, `updateKeywordDict`, `deleteKeywordDict`
- 基准数据管理：`getPricingBaselines`, `addPricingBaseline`, `updatePricingBaseline`, `deletePricingBaseline`
- 支持IndexedDB和SQLite双环境

**3. 前端UI组件**
- **词典维护面板**：
  - 表格展示所有词典条目
  - 行内编辑功能（点击编辑按钮进入编辑模式）
  - 新增条目表单（标签、显示名称、匹配模式、工时、复杂度、权重）
  - 删除确认机制

- **基准数据面板**：
  - 复杂度系数配置（S/M/L倍数）
  - 基础工时和默认费率设置
  - 表格形式展示和编辑

**4. 核心功能特性**
- ✅ 词典条目表格显示（tag、display_name、patterns、hours、complexity）
- ✅ 行内编辑功能：实时修改所有字段
- ✅ 新增/删除词典条目功能
- ✅ 基准数据配置界面（复杂度系数、默认费率）
- ✅ JSON格式的词典数据导入/导出
- ✅ 数据验证和错误提示
- ✅ 一键重识别功能入口（与任务#24配合）
- ✅ 响应式布局，适配不同屏幕尺寸

### 🎯 界面特色

- **简洁易用**：采用表格形式展示，支持行内编辑
- **数据验证**：输入验证确保数据完整性
- **导入导出**：支持JSON格式的批量数据迁移
- **响应式设计**：适配桌面和移动设备
- **实时反馈**：操作成功/失败的消息提示

### 📁 文件修改

仅修改了 `index.html` 文件，符合任务约束要求：
- 添加了数据库表结构（IndexedDB升级）
- 实现了完整的后端API接口
- 创建了前端React组件和维护界面
- 未修改现有业务逻辑和识别算法

### 🔧 技术实现

- **数据库**：IndexedDB（Web环境）和SQLite（Electron环境）
- **前端**：React 18.2.0 + Tailwind CSS
- **状态管理**：React useState
- **数据格式**：JSON存储patterns数组
- **UI组件**：表格、表单、按钮等基础组件
- **交互设计**：行内编辑、模态框确认、文件上传

### 🚀 后续集成

词典维护功能现已完全实现，可以为以下任务提供数据支持：
- 任务#24（规则引擎）提供词典数据管理
- 任务#23（简洁模式UI）提供配置界面
- 任务#26（税费计算）提供基准数据

**完成时间**：2025-09-15
**实际耗时**：约4小时
**状态**：✅ 已完成所有验收标准
