# [P0.4] 规则识别引擎实现

id: 24
title: 规则识别（词典+正则）产出候选功能条目，含证据片段/置信度
priority: P0
estimate: 5番茄 (7小时)
status: todo
depends_on: []
parallel_with: [20, 22, 25]
module: extraction
ext_id:

## 目的/产出
实现基于技术词典的规则识别引擎，从PRD文本中提取候选功能条目，包含证据片段和置信度评估。

## 实施步骤

1. keyword_dict表结构创建和数据导入
   - 创建keyword_dict表，包含tag、display_name、patterns_json等字段
   - 导入20+技术标签的初始数据（15个核心+5个扩展）
   - 实现patterns_json的解析和匹配逻辑

2. 文本预处理算法实现
   - 文本分段：按标题、段落、列表结构切分
   - 格式化：去除特殊字符、标准化空白
   - 噪音过滤：移除无关内容（如版权声明、联系方式）

3. 词典匹配算法实现
   - 多模式匹配：支持正则表达式、关键词、同义词匹配
   - 权重计算：根据匹配质量和模式重要性计算置信度
   - 冲突解决：同一功能多次命中时取高权重版本

4. 置信度评估逻辑
   - 基于匹配位置（标题vs正文）加权
   - 基于匹配频率（多次提及）加权
   - 基于模式复杂度（具体vs模糊）加权

5. 识别结果数据结构
   - 生成功能条目数组，包含tag、name、complexity、estimated_hours
   - 保存证据片段（section、text、offset）
   - 计算整体置信度评分

## 验收标准

- ✅ keyword_dict表创建成功，20+技术标签数据导入正确
- ✅ 文本预处理能正确处理200k字符，分段合理
- ✅ 词典匹配能识别常见技术术语，误报率<15%
- ✅ 置信度评分合理，高置信度结果准确率>80%
- ✅ 识别结果包含完整的证据片段和来源信息
- ✅ 处理速度在可接受范围内（<3秒）

## 约束/边界

**仅修改以下文件/模块**：
- main.js (识别算法和数据库操作)
- 新增keyword_dict相关功能

**明确不修改**：
- 现有业务逻辑和UI组件
- 其他数据库表结构
- 复杂度系数和报价计算逻辑

## 依赖/并行

- **依赖**: 无，可独立执行
- **可并行**: 20(复杂度系数), 22(虚拟线索), 25(词典维护)

## 风险与回退

**可能风险**：
- 词典覆盖不足导致漏识别
- 匹配算法过于严格或宽松
- 大文本处理性能问题

**回退方式**：
- 提供词典编辑界面，允许用户补充词汇
- 调整匹配阈值参数
- 大文本时分批处理，显示进度
